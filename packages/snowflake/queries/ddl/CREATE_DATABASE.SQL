// Creating the initial Snowflake database to store ingested data from a Google Cloud Bucket

USE ROLE SYSADMIN // or a role which is granted the appropriate permissions to create database, schema, and warehouse objects
// TODO: create a role which is limited to only the exact permissions needed to execute this

CREATE DATABASE NC_CAMPAIGN_FINANCE;
CREATE SCHEMA NCCF;
CREATE WAREHOUSE NCCF_DEV_WH
    WITH WAREHOUSE_SIZE = 'XSMALL'
    WAREHOUSE_TYPE = 'STANDARD'
    AUTO_SUSPEND = 60
    AUTO_RESUME = TRUE;


USE ROLE SECURITYADMIN; // or a role which is granted the appropriate permissions to grant permissions
// TODO: limit this to just permissions required for these exact functions

CREATE ROLE NCCF_DEV;
GRANT ALL PRIVILEGES ON DATABASE NC_CAMPAIGN_FINANCE TO NCCF_DEV;
GRANT ALL PRIVILEGES ON SCHEMA NC_CAMPAIGN_FINANCE.NCCF TO NCCF_DEV;
GRANT ALL PRIVILEGES ON WAREHOUSE NCCF_DEV_WH to NCCF_DEV;
GRANT ALL PRIVILEGES ON FUTURE SCHEMAS IN DATABASE NC_CAMPAIGN_FINANCE TO NCCF_DEV;
GRANT ALL PRIVILEGES ON FUTURE TABLES IN SCHEMA NC_CAMPAIGN_FINANCE.NCCF to NCCF_DEV;
GRANT ALL PRIVILEGES ON FUTURE VIEWS IN SCHEMA NC_CAMPAIGN_FINANCE.NCCF to NCCF_DEV;

GRANT ROLE NCCF_DEV to USER JIMMY; # add your username

USE ROLE USERADMIN;

CREATE USER NCCF_SVC PASSWORD = 'insert-really-good-password-here' DEFAULT_ROLE = "NCCF_DEV" DEFAULT_WAREHOUSE = 'NCCF_DEV_WH' DEFAULT_NAMESPACE = 'NC_CAMPAIGN_FINANCE.NCCF' MUST_CHANGE_PASSWORD = TRUE;

USE ROLE SECURITYADMIN;
GRANT ROLE "NCCF_DEV" to USER NCCF_SVC;
